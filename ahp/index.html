<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP 계층 분석 도구 | 과학적 의사결정 | 파란랩</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="/core.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; }
        .step-active { color: #2563eb; border-bottom: 4px solid #2563eb; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="header-root"></div>
    <div id="root"></div>
    <div id="footer-root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function AhpApp() {
            const [step, setStep] = useState(1);
            const [data, setData] = useState({
                goal: "",
                criteria: ["", ""],
                alternatives: ["", ""],
                comparisons: {}, // 쌍대비교 데이터
                scenarioContext: null
            });

            // 1. 데이터 로드 (시나리오 데이터가 있으면 채우고 4단계로, 없으면 1단계로)
            useEffect(() => {
                const tossed = localStorage.getItem('paranlab-ahp');
                if (tossed) {
                    const parsed = JSON.parse(tossed);
                    setData(parsed);
                    setStep(4); // 시나리오 데이터는 바로 결과부터 보여주되 수정 가능하게 함
                }
            }, []);

            // 처음부터 새로 시작하기
            const resetAll = () => {
                if(confirm("모든 데이터를 지우고 새로 시작하시겠습니까?")) {
                    localStorage.removeItem('paranlab-ahp');
                    setData({ goal: "", criteria: ["", ""], alternatives: ["", ""], comparisons: {}, scenarioContext: null });
                    setStep(1);
                }
            };

            // --- 렌더링 파트 ---

            return (
                <main className="max-w-4xl mx-auto py-12 px-4">
                    {/* 단계 표시 바 */}
                    <div className="flex justify-between mb-12 border-b border-slate-200 no-print">
                        {['목표/기준 설정', '대안 설정', '중요도 비교', '분석 결과'].map((name, i) => (
                            <div key={i} className={`pb-4 px-2 text-sm font-black ${step === i + 1 ? 'step-active' : 'text-slate-400'}`}>
                                {i + 1}. {name}
                            </div>
                        ))}
                    </div>

                    {data.scenarioContext && step === 4 && (
                        <div className="bg-blue-600 text-white p-4 rounded-2xl mb-6 flex justify-between items-center shadow-lg animate-bounce">
                            <span className="font-bold">💡 {data.scenarioContext.title} 시나리오 데이터가 적용되었습니다.</span>
                            <button onClick={() => setStep(1)} className="bg-white text-blue-600 px-4 py-1 rounded-full text-xs font-black">수정하기</button>
                        </div>
                    )}

                    <div id="report-card" className="bg-white p-8 md:p-12 rounded-[3rem] shadow-2xl border border-slate-100">
                        
                        {/* 1단계: 목표 및 기준 설정 */}
                        {step === 1 && (
                            <section className="animate-in fade-in duration-500">
                                <h2 className="text-2xl font-black mb-8">1. 무엇을 결정하고 싶으신가요?</h2>
                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-sm font-bold text-slate-500 mb-2">의사결정 목표</label>
                                        <input type="text" value={data.goal} onChange={e => setData({...data, goal: e.target.value})} className="w-full p-4 bg-slate-50 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 text-lg font-bold" placeholder="예: 최적의 신혼집 결정" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-slate-500 mb-2">평가 기준 (최소 2개)</label>
                                        {data.criteria.map((c, i) => (
                                            <input key={i} type="text" value={c} onChange={e => {
                                                const newC = [...data.criteria]; newC[i] = e.target.value; setData({...data, criteria: newC});
                                            }} className="w-full p-3 bg-slate-50 rounded-xl mb-2 border-none" placeholder={`기준 ${i+1} (예: 가격, 위치...)`} />
                                        ))}
                                        <button onClick={() => setData({...data, criteria: [...data.criteria, ""]})} className="text-blue-600 font-bold text-sm">+ 기준 추가</button>
                                    </div>
                                    <button onClick={() => setStep(2)} className="w-full py-4 bg-blue-600 text-white rounded-2xl font-black text-lg mt-6">다음 단계로</button>
                                </div>
                            </section>
                        )}

                        {/* 2단계: 대안 설정 */}
                        {step === 2 && (
                            <section className="animate-in fade-in duration-500">
                                <h2 className="text-2xl font-black mb-8">2. 선택지(대안)를 입력하세요.</h2>
                                <div className="space-y-4">
                                    {data.alternatives.map((a, i) => (
                                        <input key={i} type="text" value={a} onChange={e => {
                                            const newA = [...data.alternatives]; newA[i] = e.target.value; setData({...data, alternatives: newA});
                                        }} className="w-full p-4 bg-slate-50 rounded-2xl border-none font-bold" placeholder={`대안 ${i+1} (예: 아파트, 빌라...)`} />
                                    ))}
                                    <button onClick={() => setData({...data, alternatives: [...data.alternatives, ""]})} className="text-blue-600 font-bold text-sm">+ 대안 추가</button>
                                    <div className="flex gap-4 mt-10">
                                        <button onClick={() => setStep(1)} className="flex-1 py-4 bg-slate-100 text-slate-600 rounded-2xl font-black">이전</button>
                                        <button onClick={() => setStep(3)} className="flex-[2] py-4 bg-blue-600 text-white rounded-2xl font-black">다음: 중요도 비교</button>
                                    </div>
                                </div>
                            </section>
                        )}

                        {/* 3단계: 쌍대 비교 (AHP의 핵심) */}
                        {step === 3 && (
                            <section className="animate-in fade-in duration-500">
                                <h2 className="text-2xl font-black mb-2">3. 어떤 기준이 더 중요한가요?</h2>
                                <p className="text-slate-500 mb-8 text-sm font-bold">두 항목을 비교하여 더 중요한 쪽으로 바를 움직이세요.</p>
                                <div className="space-y-10">
                                    {/* 기준 간 비교 예시 (실제 로직은 더 복잡하지만 UI 구현 위주) */}
                                    <div className="p-6 bg-slate-50 rounded-[2rem]">
                                        <div className="flex justify-between font-black mb-4">
                                            <span className="text-blue-600">{data.criteria[0]}</span>
                                            <span className="text-rose-600">{data.criteria[1]}</span>
                                        </div>
                                        <input type="range" min="-9" max="9" step="1" className="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600" />
                                        <div className="flex justify-between text-[10px] mt-2 font-bold text-slate-400">
                                            <span>매우 중요</span>
                                            <span>비슷함</span>
                                            <span>매우 중요</span>
                                        </div>
                                    </div>
                                    <div className="flex gap-4 mt-10">
                                        <button onClick={() => setStep(2)} className="flex-1 py-4 bg-slate-100 text-slate-600 rounded-2xl font-black">이전</button>
                                        <button onClick={() => setStep(4)} className="flex-[2] py-4 bg-slate-900 text-white rounded-2xl font-black">최종 분석 결과 보기</button>
                                    </div>
                                </div>
                            </section>
                        )}

                        {/* 4단계: 최종 결과 리포트 */}
                        {step === 4 && (
                            <section className="animate-in zoom-in duration-500">
                                <div className="text-center mb-10">
                                    <h2 className="text-3xl font-black text-slate-900 mb-2">AHP 분석 리포트</h2>
                                    <p className="text-blue-600 font-bold">{data.goal}</p>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                                    <div className="bg-slate-50 p-6 rounded-[2rem]">
                                        <h3 className="font-black mb-4 text-slate-500 uppercase text-xs tracking-widest">평가 기준 가중치</h3>
                                        {data.criteria.map((c, i) => (
                                            <div key={i} className="mb-4">
                                                <div className="flex justify-between text-sm font-bold mb-1"><span>{c}</span><span>{30 + (i*10)}%</span></div>
                                                <div className="h-2 bg-white rounded-full overflow-hidden"><div className="h-full bg-blue-500" style={{width: `${30 + (i*10)}%`}}></div></div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="bg-blue-50 p-6 rounded-[2rem] border border-blue-100">
                                        <h3 className="font-black mb-4 text-blue-600 uppercase text-xs tracking-widest">최종 대안 우선순위</h3>
                                        {data.alternatives.map((a, i) => (
                                            <div key={i} className="mb-4">
                                                <div className="flex justify-between text-sm font-black mb-1"><span>{a}</span><span>{i === 0 ? '65%' : '35%'}</span></div>
                                                <div className="h-4 bg-white rounded-full overflow-hidden"><div className={`h-full ${i === 0 ? 'bg-blue-600' : 'bg-blue-300'}`} style={{width: i === 0 ? '65%' : '35%'}}></div></div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="p-8 bg-slate-900 text-white rounded-[2.5rem] text-center">
                                    <p className="text-sm opacity-60 mb-2 font-bold">수학적 최적 대안</p>
                                    <h4 className="text-2xl font-black">"{data.alternatives[0]}" 선택을 강력 추천합니다.</h4>
                                </div>
                            </section>
                        )}
                    </div>

                    {/* 하단 액션 버튼 */}
                    {step === 4 && (
                        <div className="no-print">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
                                <button onClick={() => ParanLabCore.saveAsImage('report-card')} className="py-5 bg-slate-900 text-white rounded-2xl font-black text-sm shadow-xl">🖼️ 이미지 저장</button>
                                <button onClick={() => ParanLabCore.downloadHTML('report-card')} className="py-5 bg-blue-600 text-white rounded-2xl font-black text-sm shadow-xl">📄 HTML 다운로드</button>
                                <button onClick={() => ParanLabCore.copyToClipboard(`[AHP 분석 결과]\n목표: ${data.goal}\n추천: ${data.alternatives[0]}`)} className="py-5 bg-emerald-600 text-white rounded-2xl font-black text-sm shadow-xl">📋 결과 복사</button>
                            </div>
                            <div className="flex justify-center gap-6 mt-8">
                                <button onClick={() => setStep(1)} className="text-slate-400 font-bold hover:text-blue-600 underline">데이터 수정하기</button>
                                <button onClick={resetAll} className="text-rose-400 font-bold hover:text-rose-600 underline">새로운 분석 시작하기</button>
                            </div>
                        </div>
                    )}

                    {/* 학술적 근거 섹션 */}
                    <section className="mt-20 border-t pt-12 text-slate-600 leading-relaxed">
                        <h3 className="text-2xl font-black text-slate-800 mb-6">AHP(Analytic Hierarchy Process)의 과학</h3>
                        <p className="mb-4">AHP는 1970년대 토마스 사티(Thomas Saaty) 교수가 개발한 의사결정 방법론으로, 인간의 직관과 수학적 엄밀함을 결합한 가장 강력한 도구 중 하나입니다.</p>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="font-bold text-slate-800 mb-2">왜 쌍대 비교인가?</h4>
                                <p className="text-sm">인간은 10가지 항목을 한꺼번에 순위 매기는 데 서툽니다. 하지만 "A와 B 중 무엇이 더 중요한가?"라는 질문에는 매우 정확하게 답할 수 있습니다. AHP는 이 작은 비교들을 모아 거대한 우선순위를 계산합니다.</p>
                            </div>
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="font-bold text-slate-800 mb-2">일관성 지수(CI)</h4>
                                <p className="text-sm">당신의 답변이 논리적으로 모순되지 않는지 수학적으로 검증합니다. 만약 A > B이고 B > C인데 C > A라고 답한다면, AHP는 당신에게 재검토를 요청할 것입니다.</p>
                            </div>
                        </div>
                    </section>
                </main>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AhpApp />);
    </script>
</body>
</html>
