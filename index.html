<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒë€ë©(Paran Lab) | AHP ì˜ì‚¬ê²°ì • ë„êµ¬</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; scroll-behavior: smooth; }
        .slider { -webkit-appearance: none; width: 100%; height: 8px; background: #e2e8f0; outline: none; border-radius: 4px; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; background: #2563eb; cursor: pointer; border-radius: 50%; border: 4px solid white; shadow: 0 2px 4px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        function App() {
            const [step, setStep] = useState(1);
            const [goal, setGoal] = useState("");
            const [criteria, setCriteria] = useState(["ê°€ê²©", "ë””ìì¸", "ì„±ëŠ¥"]);
            const [alternatives, setAlternatives] = useState(["ëŒ€ì•ˆ A", "ëŒ€ì•ˆ B"]);
            const [comparisons, setComparisons] = useState({});

            // 1. ê¸°ì¤€ ì¶”ê°€/ì‚­ì œ
            const addCriterion = () => setCriteria([...criteria, ""]);
            const updateCriterion = (index, value) => {
                const newCriteria = [...criteria];
                newCriteria[index] = value;
                setCriteria(newCriteria);
            };
            const removeCriterion = (index) => setCriteria(criteria.filter((_, i) => i !== index));

            // 2. ëŒ€ì•ˆ ì¶”ê°€/ì‚­ì œ
            const addAlternative = () => setAlternatives([...alternatives, ""]);
            const updateAlternative = (index, value) => {
                const newAlts = [...alternatives];
                newAlts[index] = value;
                setAlternatives(newAlts);
            };
            const removeAlternative = (index) => setAlternatives(alternatives.filter((_, i) => i !== index));

            // 3. ìŒëŒ€ë¹„êµ ìŒ ìƒì„±
            const criteriaPairs = useMemo(() => {
                const pairs = [];
                for (let i = 0; i < criteria.length; i++) {
                    for (let j = i + 1; j < criteria.length; j++) {
                        pairs.push([i, j]);
                    }
                }
                return pairs;
            }, [criteria]);

            // 4. AHP ê³„ì‚° ë¡œì§ (ê°„ì†Œí™”ëœ ê³ ìœ ë²¡í„° ë°©ì‹)
            const calculateResult = () => {
                const n = criteria.length;
                const matrix = Array(n).fill(0).map(() => Array(n).fill(1));
                
                criteriaPairs.forEach(([i, j]) => {
                    const val = parseFloat(comparisons[`${i}-${j}`] || 1);
                    if (val > 0) {
                        matrix[i][j] = val;
                        matrix[j][i] = 1 / val;
                    } else {
                        matrix[i][j] = 1 / Math.abs(val);
                        matrix[j][i] = Math.abs(val);
                    }
                });

                // ì •ê·œí™” ë° ê°€ì¤‘ì¹˜ ê³„ì‚°
                const colSums = Array(n).fill(0);
                for (let j = 0; j < n; j++) {
                    for (let i = 0; i < n; i++) colSums[j] += matrix[i][j];
                }

                const weights = Array(n).fill(0);
                for (let i = 0; i < n; i++) {
                    for (let j = 0; j < n; j++) {
                        weights[i] += (matrix[i][j] / colSums[j]);
                    }
                    weights[i] /= n;
                }
                return weights;
            };

            const results = step === 4 ? calculateResult() : null;

            return (
                <div className="min-h-screen py-8 px-4 max-w-2xl mx-auto">
                    <header className="text-center mb-10">
                        <h1 className="text-3xl font-bold text-blue-900 mb-2">Paran Lab</h1>
                        <div className="flex justify-center gap-2">
                            {[1, 2, 3, 4].map(s => (
                                <div key={s} className={`w-3 h-3 rounded-full ${step >= s ? 'bg-blue-600' : 'bg-slate-200'}`} />
                            ))}
                        </div>
                    </header>

                    {/* STEP 1: ëª©í‘œ ë° ê¸°ì¤€ ì„¤ì • */}
                    {step === 1 && (
                        <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 animate-fadeIn">
                            <h2 className="text-xl font-bold mb-6">1. ë¬´ì—‡ì„ ë¹„êµí• ê¹Œìš”?</h2>
                            <div className="mb-8">
                                <label className="block text-sm font-medium text-slate-500 mb-2">ê²°ì •í•  ëª©í‘œ</label>
                                <input 
                                    value={goal} onChange={(e) => setGoal(e.target.value)}
                                    placeholder="ì˜ˆ: ìµœê³ ì˜ ë…¸íŠ¸ë¶ ê³ ë¥´ê¸°"
                                    className="w-full p-4 bg-slate-50 border-none rounded-2xl focus:ring-2 ring-blue-500 outline-none"
                                />
                            </div>
                            <div className="mb-8">
                                <label className="block text-sm font-medium text-slate-500 mb-2">ë¹„êµ ê¸°ì¤€ (ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒ)</label>
                                {criteria.map((c, i) => (
                                    <div key={i} className="flex gap-2 mb-2">
                                        <input 
                                            value={c} onChange={(e) => updateCriterion(i, e.target.value)}
                                            className="flex-1 p-3 bg-slate-50 border-none rounded-xl outline-none"
                                        />
                                        <button onClick={() => removeCriterion(i)} className="px-3 text-slate-400">Ã—</button>
                                    </div>
                                ))}
                                <button onClick={addCriterion} className="text-blue-600 text-sm font-bold mt-2">+ ê¸°ì¤€ ì¶”ê°€</button>
                            </div>
                            <button onClick={() => setStep(2)} className="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold">ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
                        </div>
                    )}

                    {/* STEP 2: ëŒ€ì•ˆ ì„¤ì • */}
                    {step === 2 && (
                        <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 animate-fadeIn">
                            <h2 className="text-xl font-bold mb-6">2. í›„ë³´(ëŒ€ì•ˆ)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</h2>
                            <div className="mb-8">
                                {alternatives.map((a, i) => (
                                    <div key={i} className="flex gap-2 mb-2">
                                        <input 
                                            value={a} onChange={(e) => updateAlternative(i, e.target.value)}
                                            className="flex-1 p-3 bg-slate-50 border-none rounded-xl outline-none"
                                        />
                                        <button onClick={() => removeAlternative(i)} className="px-3 text-slate-400">Ã—</button>
                                    </div>
                                ))}
                                <button onClick={addAlternative} className="text-blue-600 text-sm font-bold mt-2">+ í›„ë³´ ì¶”ê°€</button>
                            </div>
                            <div className="flex gap-4">
                                <button onClick={() => setStep(1)} className="flex-1 py-4 bg-slate-100 rounded-2xl font-bold">ì´ì „</button>
                                <button onClick={() => setStep(3)} className="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-bold">ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
                            </div>
                        </div>
                    )}

                    {/* STEP 3: ì¤‘ìš”ë„ ë¹„êµ (AHPì˜ í•µì‹¬) */}
                    {step === 3 && (
                        <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 animate-fadeIn">
                            <h2 className="text-xl font-bold mb-2">3. ì–´ëŠ ìª½ì´ ë” ì¤‘ìš”í•œê°€ìš”?</h2>
                            <p className="text-slate-500 text-sm mb-8">ë‘ í•­ëª©ì„ ë¹„êµí–ˆì„ ë•Œ ë” ìš°ì„ ì‹œí•˜ëŠ” ìª½ìœ¼ë¡œ ì¡°ì ˆí•˜ì„¸ìš”.</p>
                            
                            <div className="space-y-12 mb-10">
                                {criteriaPairs.map(([i, j]) => (
                                    <div key={`${i}-${j}`} className="space-y-4">
                                        <div className="flex justify-between font-bold text-sm">
                                            <span className={comparisons[`${i}-${j}`] > 1 ? "text-blue-600" : ""}>{criteria[i]}</span>
                                            <span className={comparisons[`${i}-${j}`] < -1 ? "text-blue-600" : ""}>{criteria[j]}</span>
                                        </div>
                                        <input 
                                            type="range" min="-9" max="9" step="1"
                                            value={comparisons[`${i}-${j}`] || 0}
                                            onChange={(e) => setComparisons({...comparisons, [`${i}-${j}`]: e.target.value})}
                                            className="slider"
                                        />
                                        <div className="text-center text-xs text-slate-400">
                                            {comparisons[`${i}-${j}`] > 0 ? `${criteria[i]}ê°€ ë” ì¤‘ìš”í•¨` : comparisons[`${i}-${j}`] < 0 ? `${criteria[j]}ê°€ ë” ì¤‘ìš”í•¨` : "ë‘ í•­ëª©ì´ ë¹„ìŠ·í•¨"}
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <button onClick={() => setStep(4)} className="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold">ê²°ê³¼ ë³´ê¸°</button>
                        </div>
                    )}

                    {/* STEP 4: ê²°ê³¼ ë¦¬í¬íŠ¸ */}
                    {step === 4 && (
                        <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 animate-fadeIn text-center">
                            <h2 className="text-2xl font-bold mb-2">ë¶„ì„ ê²°ê³¼</h2>
                            <p className="text-slate-500 mb-8">ë‹¹ì‹ ì˜ ì ì¬ì  ì„ í˜¸ë„ë¥¼ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
                            
                            <div className="space-y-4 mb-10">
                                {results && criteria.map((c, i) => (
                                    <div key={i} className="text-left">
                                        <div className="flex justify-between text-sm mb-1">
                                            <span className="font-bold">{c}</span>
                                            <span>{(results[i] * 100).toFixed(1)}%</span>
                                        </div>
                                        <div className="w-full bg-slate-100 h-4 rounded-full overflow-hidden">
                                            <div 
                                                className="bg-blue-600 h-full transition-all duration-1000" 
                                                style={{ width: `${results[i] * 100}%` }}
                                            />
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="p-6 bg-blue-50 rounded-2xl mb-8 text-left">
                                <h3 className="font-bold text-blue-900 mb-2">ğŸ’¡ í•´ì„ ê°€ì´ë“œ</h3>
                                <p className="text-sm text-blue-800 leading-relaxed">
                                    ê°€ì¥ ë†’ì€ í¼ì„¼íŠ¸ë¥¼ ê¸°ë¡í•œ <strong>{criteria[results.indexOf(Math.max(...results))]}</strong> í•­ëª©ì´ 
                                    í˜„ì¬ {goal || "ì´ ê²°ì •"}ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œë¡œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤. ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ëŒ€ì•ˆì„ ì„ íƒí•´ ë³´ì„¸ìš”!
                                </p>
                            </div>

                            <button onClick={() => setStep(1)} className="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</body>
</html>
