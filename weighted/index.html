<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í∞ÄÏ§ëÏπò Ï†êÏàò Î™®Îç∏ Î∂ÑÏÑù | ÌååÎûÄÎû©</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/core.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root">
        <div id="weighted-app" class="max-w-2xl mx-auto py-10 px-4"></div>
    </div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        function WeightedApp() {
            const [step, setStep] = useState(1); // 1: Ï£ºÏ†ú/ÌõÑÎ≥¥/Í∏∞Ï§Ä, 2: Í∞ÄÏ§ëÏπò ÏÑ§Ï†ï, 3: Ï†êÏàò ÏûÖÎ†•, 4: Í≤∞Í≥º
            const [subject, setSubject] = useState("");
            const [alternatives, setAlternatives] = useState(["ÌõÑÎ≥¥ A", "ÌõÑÎ≥¥ B"]);
            const [criteria, setCriteria] = useState([{ text: "Í∞ÄÍ≤©", weight: 5 }, { text: "ÏÑ±Îä•", weight: 5 }]);
            const [scores, setScores] = useState({}); // { "altIdx-critIdx": score }

            const updateWeight = (idx, val) => {
                const newCriteria = [...criteria];
                newCriteria[idx].weight = parseInt(val);
                setCriteria(newCriteria);
            };

            const finalResults = useMemo(() => {
                if (step !== 4) return null;
                const totalWeight = criteria.reduce((acc, c) => acc + c.weight, 0);
                return alternatives.map((alt, altIdx) => {
                    let totalScore = 0;
                    criteria.forEach((crit, critIdx) => {
                        const score = scores[`${altIdx}-${critIdx}`] || 5;
                        totalScore += score * (crit.weight / totalWeight);
                    });
                    return { name: alt, score: totalScore * 10 }; // 100Ï†ê ÎßåÏ†ê ÌôòÏÇ∞
                }).sort((a, b) => b.score - a.score);
            }, [step, scores, criteria, alternatives]);

            const saveAsHtml = () => {
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head><meta charset="UTF-8"><title>Í∞ÄÏ§ëÏπò Ï†êÏàò Î∂ÑÏÑù Î≥¥Í≥†ÏÑú</title><style>body{font-family:sans-serif;padding:40px;max-width:500px;margin:0 auto;}h1{border-bottom:4px solid #2563eb;padding-bottom:10px;}.box{padding:20px;border-radius:15px;margin-bottom:15px;background:#f8fafc;border:1px solid #eee;}</style></head>
                    <body>
                        <h1>üìä Í∞ÄÏ§ëÏπò Ï†êÏàò Î∂ÑÏÑù Î≥¥Í≥†ÏÑú</h1>
                        <p><strong>Î∂ÑÏÑù Ï£ºÏ†ú:</strong> ${subject}</p>
                        <div style="margin-top:30px;">
                            ${finalResults.map((res, i) => `<div class="box"><strong>${i+1}ÏúÑ: ${res.name}</strong> - ${res.score.toFixed(1)}Ï†ê</div>`).join('')}
                        </div>
                        <div style="font-size:12px; color:#999; text-align:center; margin-top:40px;">¬© 2025 Paran Lab.</div>
                    </body>
                    </html>
                `;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `weighted_scoring_${new Date().getTime()}.html`;
                a.click();
            };

            return (
                <div className="animate-in fade-in duration-500">
                    {/* STEP 1: Í∏∞Î≥∏ ÏÑ§Ï†ï */}
                    {step === 1 && (
                        <div className="bg-white p-10 rounded-[3rem] shadow-2xl border border-slate-100">
                            <h2 className="text-3xl font-black text-slate-900 mb-6">Î¨¥ÏóáÏùÑ ÎπÑÍµêÌï†ÍπåÏöî?</h2>
                            <input value={subject} onChange={(e)=>setSubject(e.target.value)} placeholder="Ïòà: ÏµúÏ†ÅÏùò ÎÖ∏Ìä∏Î∂Å Í≥†Î•¥Í∏∞" className="w-full p-5 bg-slate-50 border-2 border-transparent focus:border-blue-500 rounded-2xl outline-none text-lg font-bold mb-8" />
                            
                            <div className="mb-8">
                                <label className="block text-xs font-black text-slate-400 mb-3 uppercase tracking-widest">ÎπÑÍµê ÌõÑÎ≥¥</label>
                                {alternatives.map((a, i) => (
                                    <div key={i} className="flex gap-2 mb-2">
                                        <input value={a} onChange={(e)=>{const n=[...alternatives]; n[i]=e.target.value; setAlternatives(n);}} className="flex-1 p-3 bg-slate-50 rounded-xl outline-none font-bold" />
                                        <button onClick={()=>setAlternatives(alternatives.filter((_,idx)=>idx!==i))} className="text-slate-300">‚úï</button>
                                    </div>
                                ))}
                                <button onClick={()=>setAlternatives([...alternatives, ""])} className="text-blue-600 font-bold text-sm">+ ÌõÑÎ≥¥ Ï∂îÍ∞Ä</button>
                            </div>

                            <div className="mb-10">
                                <label className="block text-xs font-black text-slate-400 mb-3 uppercase tracking-widest">ÌåêÎã® Í∏∞Ï§Ä</label>
                                {criteria.map((c, i) => (
                                    <div key={i} className="flex gap-2 mb-2">
                                        <input value={c.text} onChange={(e)=>{const n=[...criteria]; n[i].text=e.target.value; setCriteria(n);}} className="flex-1 p-3 bg-slate-50 rounded-xl outline-none font-bold" />
                                        <button onClick={()=>setCriteria(criteria.filter((_,idx)=>idx!==i))} className="text-slate-300">‚úï</button>
                                    </div>
                                ))}
                                <button onClick={()=>setCriteria([...criteria, {text:"", weight:5}])} className="text-blue-600 font-bold text-sm">+ Í∏∞Ï§Ä Ï∂îÍ∞Ä</button>
                            </div>

                            <button onClick={()=>setStep(2)} className="w-full py-6 bg-blue-600 text-white rounded-[2rem] font-black text-xl shadow-xl shadow-blue-200">Îã§Ïùå Îã®Í≥ÑÎ°ú</button>
                        </div>
                    )}

                    {/* STEP 2: Í∞ÄÏ§ëÏπò ÏÑ§Ï†ï */}
                    {step === 2 && (
                        <div className="bg-white p-10 rounded-[3rem] shadow-2xl border border-slate-100">
                            <h2 className="text-2xl font-black text-slate-900 mb-2">ÏñºÎßàÎÇò Ï§ëÏöîÌïúÍ∞ÄÏöî?</h2>
                            <p className="text-slate-500 mb-10 font-medium">Í∞Å Í∏∞Ï§ÄÏù¥ Í≤∞Ï†ïÏóê ÎØ∏ÏπòÎäî ÎπÑÏ§ëÏùÑ Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.</p>
                            <div className="space-y-8 mb-10">
                                {criteria.map((c, i) => (
                                    <div key={i}>
                                        <div className="flex justify-between mb-2 font-bold">
                                            <span>{c.text}</span>
                                            <span className="text-blue-600">{c.weight}</span>
                                        </div>
                                        <input type="range" min="1" max="10" value={c.weight} onChange={(e)=>updateWeight(i, e.target.value)} className="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600" />
                                    </div>
                                ))}
                            </div>
                            <div className="flex gap-4">
                                <button onClick={()=>setStep(1)} className="flex-1 py-6 bg-slate-100 text-slate-400 rounded-[2rem] font-black text-xl">Ïù¥Ï†Ñ</button>
                                <button onClick={()=>setStep(3)} className="flex-1 py-6 bg-blue-600 text-white rounded-[2rem] font-black text-xl shadow-xl shadow-blue-200">Ï†êÏàò ÏûÖÎ†•ÌïòÍ∏∞</button>
                            </div>
                        </div>
                    )}

                    {/* STEP 3: Ï†êÏàò ÏûÖÎ†• */}
                    {step === 3 && (
                        <div className="bg-white p-10 rounded-[3rem] shadow-2xl border border-slate-100">
                            <h2 className="text-2xl font-black text-slate-900 mb-10">ÌõÑÎ≥¥Î≥Ñ Ï†êÏàò Îß§Í∏∞Í∏∞</h2>
                            <div className="space-y-12">
                                {criteria.map((crit, critIdx) => (
                                    <div key={critIdx} className="p-6 bg-slate-50 rounded-[2rem] border border-slate-100">
                                        <h3 className="font-black text-blue-900 mb-6 flex items-center">
                                            <span className="w-2 h-6 bg-blue-600 rounded-full mr-3"></span>
                                            {crit.text} (ÎπÑÏ§ë: {crit.weight})
                                        </h3>
                                        {alternatives.map((alt, altIdx) => (
                                            <div key={altIdx} className="mb-6 last:mb-0">
                                                <div className="flex justify-between text-sm mb-2 font-bold text-slate-600">
                                                    <span>{alt}</span>
                                                    <span className="text-blue-600">{scores[`${altIdx}-${critIdx}`] || 5}Ï†ê</span>
                                                </div>
                                                <input type="range" min="1" max="10" value={scores[`${altIdx}-${critIdx}`] || 5} onChange={(e)=>setScores({...scores, [`${altIdx}-${critIdx}`]: parseInt(e.target.value)})} className="w-full h-1.5 accent-blue-600" />
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                            <div className="flex gap-4 mt-10">
                                <button onClick={()=>setStep(2)} className="flex-1 py-6 bg-slate-100 text-slate-400 rounded-[2rem] font-black text-xl">Ïù¥Ï†Ñ</button>
                                <button onClick={()=>setStep(4)} className="flex-1 py-6 bg-blue-600 text-white rounded-[2rem] font-black text-xl shadow-xl shadow-blue-200">Í≤∞Í≥º Î≥¥Í∏∞</button>
                            </div>
                        </div>
                    )}

                    {/* STEP 4: Í≤∞Í≥º */}
                    {step === 4 && (
                        <div className="bg-white p-10 rounded-[3rem] shadow-2xl border border-slate-100 text-center">
                            <h2 className="text-4xl font-black text-slate-900 mb-2 text-blue-600">ÏµúÏ¢Ö Î∂ÑÏÑù Í≤∞Í≥º</h2>
                            <p className="text-slate-500 mb-12 font-medium">Í∞ÄÏ§ëÏπòÎ•º Î∞òÏòÅÌïú 100Ï†ê ÎßåÏ†ê Í∏∞Ï§Ä Ï†êÏàòÏûÖÎãàÎã§.</p>
                            <div className="space-y-6 mb-12">
                                {finalResults.map((res, i) => (
                                    <div key={i} className={`p-8 rounded-[2.5rem] border-4 transition-all ${i === 0 ? 'border-blue-600 bg-blue-50/30 scale-105 shadow-xl shadow-blue-100' : 'border-slate-50 bg-white'}`}>
                                        <div className="flex justify-between items-center">
                                            <div className="text-left">
                                                <span className={`text-xs font-black px-4 py-1.5 rounded-full mb-3 inline-block uppercase tracking-widest ${i === 0 ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-500'}`}>{i + 1}ÏúÑ Ï∂îÏ≤ú</span>
                                                <h3 className="text-2xl font-black text-slate-900">{res.name}</h3>
                                            </div>
                                            <div className="text-right">
                                                <span className="text-5xl font-black text-blue-600">{res.score.toFixed(0)}</span><span className="text-slate-300 text-xl font-black ml-1">Ï†ê</span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="grid grid-cols-1 gap-4">
                                <button onClick={saveAsHtml} className="py-6 bg-slate-900 text-white rounded-[2rem] font-black text-xl shadow-xl">Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú (.html)</button>
                                <button onClick={()=>setStep(1)} className="py-6 bg-slate-100 text-slate-400 rounded-[2rem] font-black text-xl">Îã§Ïãú ÌïòÍ∏∞</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('weighted-app')).render(<WeightedApp />);
    </script>
</body>
</html>
